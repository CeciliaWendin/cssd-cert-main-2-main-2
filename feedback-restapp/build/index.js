(()=>{"use strict";var e={n:a=>{var t=a&&a.__esModule?()=>a.default:()=>a;return e.d(t,{a:t}),t},d:(a,t)=>{for(var r in t)e.o(t,r)&&!e.o(a,r)&&Object.defineProperty(a,r,{enumerable:!0,get:t[r]})},o:(e,a)=>Object.prototype.hasOwnProperty.call(e,a)};const a=require("events");var t=e.n(a);const r=require("storage");var n=e.n(r);const s=require("LogUtil");var o=e.n(s),i=n().getCollectionDataStore("pageFeedback");t().on("sv:publishing:publish",(function(e){var a;a=e.node,i.find("ds.analyzed.page:".concat(a," ds.analyzed.isOutdated:false"),{count:100}).toArray().forEach((function(e){if(!e.isOutdated){e.isOutdated=!0;try{i.set(e.dsid,e)}catch(e){o().info("Could not write to DataStore")}}}))}));const c=require("router");var d=e.n(c);const u=require("MailUtil");var l=e.n(u);const p=function(e){o().info(JSON.stringify(e.pageName));try{return l().getMailBuilder().setSubject(" ".concat(e.pageName)).setHtmlMessage("".concat(e.userName," has provided this feedback: ").concat(e.feedback,',\n         Link to site: <a href="').concat(e.pageURL,'">').concat(e.pageName,"</a> ")).addRecipient(e.email).build().send(),!0}catch(e){return console.error("Cant send email:",e),!1}};d().get("/sendMail",(function(e,a){var t={email:e.params.email,userName:e.params.userName,feedback:e.params.feedback,pageURL:e.params.pageURL,pageName:e.params.pageName};return p(t)?a.status(204).send("Email was successfully sent."):a.status(400).send("Failed to send Email.")}))})();